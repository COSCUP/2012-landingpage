(function(h){Array.prototype.shuffle=function(){for(var j,a,g=this.length;g;j=parseInt(Math.random()*g),a=this[--g],this[g]=this[j],this[j]=a);return this};h.fn.imageCloud=function(j){var a={gridSize:8,ellipticity:1,query:'select * from flickr.photos.search(0,150) where group_id="1502528@N22" and sort="interestingness-desc"',flickrSize:"s",photos:false,photoListType:"flickr",wait:50,fadeIn:200,weightFactor:function(b){b=1-b;return b*b},shuffle:true};j&&h.extend(a,j);var g,i,m,r,s={flickr:function(b){return{width:b["width_"+
a.flickrSize],height:b["height_"+a.flickrSize],photo_url:b["url_"+a.flickrSize],link_url:"http://www.flickr.com/photos/"+b.owner+"/"+b.id,title:b.title}}},u=function(b,c,d,e){if(b<0||c<0||b+d>g||c+e>i)return false;d=d;for(var f;d--;)for(f=e;f--;)if(!m[b+d][c+f])return false;return true},v=function(b,c,d,e){d=d;for(var f;d--;)for(f=e;f--;)m[b+d][c+f]=false},w=function(b,c,d){d=a.weightFactor(d)*r;var e=Math.ceil(c.width*d/a.gridSize),f=Math.ceil(c.height/c.width*e);if(e===0||f===0)return false;var n=
Math.floor(Math.sqrt(g*g+i*i));d=g+i;var k,o,q;for(k=n;k--;){o=d;for(q=[];o--;)q.push([Math.floor(g/2+(n-k)*Math.cos(o/d*2*Math.PI)-e/2),Math.floor(i/2+(n-k)*a.ellipticity*Math.sin(o/d*2*Math.PI)-f/2)]);if(q.shuffle().some(function(l){if(u(l[0],l[1],e,f)){var p=h("<img />");p.css({width:(e*a.gridSize).toString(10)+"px",height:(f*a.gridSize).toString(10)+"px",left:(l[0]*a.gridSize).toString(10)+"px",top:(l[1]*a.gridSize).toString(10)+"px",display:"none",opacity:k*k/n/n});p[0].onload=function(){h(this).fadeIn(a.fadeIn)};
var t=h('<a href="'+c.link_url+'" target="_blank" />').append(p);t.attr("title",c.title);b.append(t);p[0].src=c.photo_url;v(l[0],l[1],e,f);return true}return false}))return true}return false};if({flickr:function(b){h.getJSON("http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(a.query+' and extras="url_'+a.flickrSize+'"')+"&format=json&diagnostics=true&callback=?",function(c){!c.query.results||!c.query.results.photo?b(false):b(c.query.results.photo)})}}[a.photoListType]&&!a.photos&&a.query){var x=
this;getFlickrPhotos(function(b){a.photos=b;x.imageCloud(a)});return this}s[a.photoListType]&&h.each(a.photos,function(b,c){a.photos[b]=s[a.photoListType](c)});if(a.shuffle)a.photos=a.photos.shuffle();return this.each(function(){g=Math.floor(this.offsetWidth/a.gridSize);i=Math.floor(this.offsetHeight/a.gridSize);m=[];r=5*this.offsetWidth*this.offsetHeight/43200/150;for(var b=h(this),c=g,d;c--;){m[c]=[];for(d=i;d--;)m[c][d]=true}b.empty();clearTimeout(b.data("imageCloud-timer"));var e=0,f=setInterval(function(){if(e>=
a.photos.length)clearTimeout(f);else{w(b,a.photos[e],e/a.photos.length);e++}},a.wait);h(this).data("wordCloud-timer",f)})}})(jQuery);

