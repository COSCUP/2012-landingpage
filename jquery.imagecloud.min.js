(function(k){Array.prototype.some||(Array.prototype.some=function(e){for(var a=Object(this),b=a.length>>>0,h=0;h<b;h++)if(h in a&&e.call(null,a[h],h,a))return!0;return!1});Array.prototype.shuffle=function(){for(var e,a,b=this.length;b;e=parseInt(Math.random()*b),a=this[--b],this[b]=this[e],this[e]=a);return this};k.imageCloudSupported=!0;k.fn.imageCloud=function(e){if(!k.imageCloudSupported)return this;var a={gridSize:8,ellipticity:1,query:'select * from flickr.photos.search(0,150) where group_id="1502528@N22" and sort="interestingness-desc"',
flickrSize:"s",photos:false,photoListType:"flickr",wait:50,beforeImageLoad:function(a,c,f){a.css("opacity",Math.pow(c/f,2)).hide()},imageLoad:function(a){a.fadeIn(200)},weight:function(a,c,f){a=5.5*f/43200/c*Math.pow((c-a)/c,2);return a>0.1?a:0},shuffle:true};e&&k.extend(a,e);var b,h,j,o,p,e={flickr:function(i){k.getJSON("http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(a.query+' and extras="url_'+a.flickrSize+'"')+"&format=json&diagnostics=true&callback=?",function(a){!a.query.results||
!a.query.results.photo?i(false):i(a.query.results.photo)})}},q={flickr:function(i){return{width:i["width_"+a.flickrSize],height:i["height_"+a.flickrSize],photo_url:i["url_"+a.flickrSize],link_url:"http://www.flickr.com/photos/"+i.owner+"/"+i.id,title:i.title}}},r=function(a,c,f,d){if(a<0||c<0||a+f>b||c+d>h)return false;for(var g;f--;)for(g=d;g--;)if(!j[a+f][c+g])return false;return true},s=function(a,c,f,d){for(var g;f--;)for(g=d;g--;)j[a+f][c+g]=false},t=function(i,c,f){var d=a.weight(f,o,p),g=Math.ceil(c.width*
d/a.gridSize),e=Math.ceil(c.height/c.width*g);if(g===0||e===0)return false;var j=Math.floor(Math.sqrt(b*b+h*h)/a.gridSize)*a.gridSize,d=b+h,l,m,n;for(l=j;l=l-a.gridSize;){m=d;for(n=[];m--;)n.push([Math.floor(b/2+(j-l)*Math.cos(m/d*2*Math.PI)-g/2),Math.floor(h/2+(j-l)*a.ellipticity*Math.sin(m/d*2*Math.PI)-e/2)]);if(n.shuffle().some(function(d){if(r(d[0],d[1],g,e)){var b=k("<img />");b.css({width:(g*a.gridSize).toString(10)+"px",height:(e*a.gridSize).toString(10)+"px",left:(d[0]*a.gridSize).toString(10)+
"px",top:(d[1]*a.gridSize).toString(10)+"px"});a.beforeImageLoad(b,l,j,f);b[0].onload=function(){a.imageLoad(b,l,j,f)};var h=k('<a href="'+c.link_url+'" target="_blank" />').append(b);h.attr("title",c.title);i.append(h);b[0].src=c.photo_url;s(d[0],d[1],g,e);return true}return false}))return true}return false};if(e[a.photoListType]&&!a.photos&&a.query){var u=this;e[a.photoListType](function(b){a.photos=b;u.imageCloud(a)});return this}q[a.photoListType]&&k.each(a.photos,function(b,c){a.photos[b]=q[a.photoListType](c)});
if(a.shuffle)a.photos=a.photos.shuffle();return this.each(function(){b=Math.floor(this.offsetWidth/a.gridSize);h=Math.floor(this.offsetHeight/a.gridSize);j=[];p=this.offsetWidth*this.offsetHeight;o=a.photos.length;for(var e=k(this),c=b,f;c--;){j[c]=[];for(f=h;f--;)j[c][f]=true}e.empty();clearTimeout(e.data("imageCloud-timer"));var d=0,g=setInterval(function(){if(d>=a.photos.length)clearTimeout(g);else{t(e,a.photos[d],d);d++}},a.wait);k(this).data("wordCloud-timer",g)})}})(jQuery);

