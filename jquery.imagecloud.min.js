(function(g){Array.prototype.shuffle=function(){for(var g,a,b=this.length;b;g=parseInt(Math.random()*b),a=this[--b],this[b]=this[g],this[g]=a);return this};g.imageCloudSupported=!!Array.prototype.some;g.fn.imageCloud=function(o){if(!g.imageCloudSupported)return this;var a={gridSize:8,ellipticity:1,query:'select * from flickr.photos.search(0,150) where group_id="1502528@N22" and sort="interestingness-desc"',flickrSize:"s",photos:!1,photoListType:"flickr",wait:50,beforeImageLoad:function(a,c,e){a.css("opacity",
Math.pow(c/e,2)).hide()},imageLoad:function(a){a.fadeIn(200)},weight:function(a,c,e){a=5.5*e/43200/c*Math.pow((c-a)/c,2);return a>0.1?a:0},shuffle:!0};o&&g.extend(a,o);var b,j,i,p,q,r={flickr:function(h){return{width:h["width_"+a.flickrSize],height:h["height_"+a.flickrSize],photo_url:h["url_"+a.flickrSize],link_url:"http://www.flickr.com/photos/"+h.owner+"/"+h.id,title:h.title}}},s=function(a,c,e,d){if(a<0||c<0||a+e>b||c+d>j)return!1;for(var f;e--;)for(f=d;f--;)if(!i[a+e][c+f])return!1;return!0},
t=function(a,c,e,d){for(var f;e--;)for(f=d;f--;)i[a+e][c+f]=!1},u=function(h,c,e){var d=a.weight(e,p,q),f=Math.ceil(c.width*d/a.gridSize),i=Math.ceil(c.height/c.width*f);if(f===0||i===0)return!1;var l=Math.floor(Math.sqrt(b*b+j*j));d=b+j;var k,m,n;for(k=l;k--;){m=d;for(n=[];m--;)n.push([Math.floor(b/2+(l-k)*Math.cos(m/d*2*Math.PI)-f/2),Math.floor(j/2+(l-k)*a.ellipticity*Math.sin(m/d*2*Math.PI)-i/2)]);if(n.shuffle().some(function(d){if(s(d[0],d[1],f,i)){var b=g("<img />");b.css({width:(f*a.gridSize).toString(10)+
"px",height:(i*a.gridSize).toString(10)+"px",left:(d[0]*a.gridSize).toString(10)+"px",top:(d[1]*a.gridSize).toString(10)+"px"});a.beforeImageLoad(b,k,l,e);b[0].onload=function(){a.imageLoad(b,k,l,e)};var j=g('<a href="'+c.link_url+'" target="_blank" />').append(b);j.attr("title",c.title);h.append(j);b[0].src=c.photo_url;t(d[0],d[1],f,i);return!0}return!1}))return!0}return!1};if({flickr:function(b){g.getJSON("http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(a.query+' and extras="url_'+
a.flickrSize+'"')+"&format=json&diagnostics=true&callback=?",function(a){!a.query.results||!a.query.results.photo?b(!1):b(a.query.results.photo)})}}[a.photoListType]&&!a.photos&&a.query){var v=this;getFlickrPhotos(function(b){a.photos=b;v.imageCloud(a)});return this}r[a.photoListType]&&g.each(a.photos,function(b,c){a.photos[b]=r[a.photoListType](c)});if(a.shuffle)a.photos=a.photos.shuffle();return this.each(function(){b=Math.floor(this.offsetWidth/a.gridSize);j=Math.floor(this.offsetHeight/a.gridSize);
i=[];q=this.offsetWidth*this.offsetHeight;p=a.photos.length;for(var h=g(this),c=b,e;c--;){i[c]=[];for(e=j;e--;)i[c][e]=!0}h.empty();clearTimeout(h.data("imageCloud-timer"));var d=0,f=setInterval(function(){d>=a.photos.length?clearTimeout(f):(u(h,a.photos[d],d),d++)},a.wait);g(this).data("wordCloud-timer",f)})}})(jQuery);

