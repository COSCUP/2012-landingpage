(function(d){if(!Array.prototype.some)Array.prototype.some=function(d){for(var a=Object(this),b=a.length>>>0,e=0;e<b;e++)if(e in a&&d.call(null,a[e],e,a))return!0;return!1};Array.prototype.shuffle=function(){for(var d,a,b=this.length;b;d=parseInt(Math.random()*b),a=this[--b],this[b]=this[d],this[d]=a);return this};d.imageCloudSupported=!0;d.fn.imageCloud=function(o){if(!d.imageCloudSupported)return this;var a={gridSize:8,ellipticity:1,query:'select * from flickr.photos.search(0,150) where group_id="1502528@N22" and sort="interestingness-desc"',
flickrSize:"s",photos:!1,photoListType:"flickr",wait:50,beforeImageLoad:function(a,c,g){a.css("opacity",Math.pow(c/g,2)).hide()},imageLoad:function(a){a.fadeIn(200)},weight:function(a,c,g){a=5.5*g/43200/c*Math.pow((c-a)/c,2);return a>0.1?a:0},shuffle:!0};o&&d.extend(a,o);var b,e,j,p,q,r={flickr:function(i){return{width:i["width_"+a.flickrSize],height:i["height_"+a.flickrSize],photo_url:i["url_"+a.flickrSize],link_url:"http://www.flickr.com/photos/"+i.owner+"/"+i.id,title:i.title}}},s=function(a,c,
g,d){if(a<0||c<0||a+g>b||c+d>e)return!1;for(var f;g--;)for(f=d;f--;)if(!j[a+g][c+f])return!1;return!0},t=function(a,c,d,b){for(var f;d--;)for(f=b;f--;)j[a+d][c+f]=!1},u=function(i,c,g){var h=a.weight(g,p,q),f=Math.ceil(c.width*h/a.gridSize),j=Math.ceil(c.height/c.width*f);if(f===0||j===0)return!1;var l=Math.floor(Math.sqrt(b*b+e*e));h=b+e;var k,m,n;for(k=l;k--;){m=h;for(n=[];m--;)n.push([Math.floor(b/2+(l-k)*Math.cos(m/h*2*Math.PI)-f/2),Math.floor(e/2+(l-k)*a.ellipticity*Math.sin(m/h*2*Math.PI)-j/
2)]);if(n.shuffle().some(function(b){if(s(b[0],b[1],f,j)){var e=d("<img />");e.css({width:(f*a.gridSize).toString(10)+"px",height:(j*a.gridSize).toString(10)+"px",left:(b[0]*a.gridSize).toString(10)+"px",top:(b[1]*a.gridSize).toString(10)+"px"});a.beforeImageLoad(e,k,l,g);e[0].onload=function(){a.imageLoad(e,k,l,g)};var h=d('<a href="'+c.link_url+'" target="_blank" />').append(e);h.attr("title",c.title);i.append(h);e[0].src=c.photo_url;t(b[0],b[1],f,j);return!0}return!1}))return!0}return!1};if({flickr:function(b){d.getJSON("http://query.yahooapis.com/v1/public/yql?q="+
encodeURIComponent(a.query+' and extras="url_'+a.flickrSize+'"')+"&format=json&diagnostics=true&callback=?",function(a){!a.query.results||!a.query.results.photo?b(!1):b(a.query.results.photo)})}}[a.photoListType]&&!a.photos&&a.query){var v=this;getFlickrPhotos(function(b){a.photos=b;v.imageCloud(a)});return this}r[a.photoListType]&&d.each(a.photos,function(b,c){a.photos[b]=r[a.photoListType](c)});if(a.shuffle)a.photos=a.photos.shuffle();return this.each(function(){b=Math.floor(this.offsetWidth/a.gridSize);
e=Math.floor(this.offsetHeight/a.gridSize);j=[];q=this.offsetWidth*this.offsetHeight;p=a.photos.length;for(var i=d(this),c=b,g;c--;){j[c]=[];for(g=e;g--;)j[c][g]=!0}i.empty();clearTimeout(i.data("imageCloud-timer"));var h=0,f=setInterval(function(){h>=a.photos.length?clearTimeout(f):(u(i,a.photos[h],h),h++)},a.wait);d(this).data("wordCloud-timer",f)})}})(jQuery);

