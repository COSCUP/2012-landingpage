(function(h){Array.prototype.shuffle=function(){for(var h,a,e=this.length;e;h=parseInt(Math.random()*e),a=this[--e],this[e]=this[h],this[h]=a);return this};h.imageCloudSupported=!!Array.prototype.some;h.fn.imageCloud=function(n){if(!h.imageCloudSupported)return this;var a={gridSize:8,ellipticity:1,query:'select * from flickr.photos.search(0,150) where group_id="1502528@N22" and sort="interestingness-desc"',flickrSize:"s",photos:!1,photoListType:"flickr",wait:50,fadeIn:200,weight:function(a,c,b){a=
5.5*b/43200/c*Math.pow((c-a)/c,2);return a>0.1?a:0},shuffle:!0};n&&h.extend(a,n);var e,j,i,o,p,q={flickr:function(d){return{width:d["width_"+a.flickrSize],height:d["height_"+a.flickrSize],photo_url:d["url_"+a.flickrSize],link_url:"http://www.flickr.com/photos/"+d.owner+"/"+d.id,title:d.title}}},r=function(a,c,b,f){if(a<0||c<0||a+b>e||c+f>j)return!1;for(var g;b--;)for(g=f;g--;)if(!i[a+b][c+g])return!1;return!0},s=function(a,c,b,f){for(var g;b--;)for(g=f;g--;)i[a+b][c+g]=!1},t=function(d,c,b){b=a.weight(b,
o,p);var f=Math.ceil(c.width*b/a.gridSize),g=Math.ceil(c.height/c.width*f);if(f===0||g===0)return!1;var i=Math.floor(Math.sqrt(e*e+j*j));b=e+j;var k,l,m;for(k=i;k--;){l=b;for(m=[];l--;)m.push([Math.floor(e/2+(i-k)*Math.cos(l/b*2*Math.PI)-f/2),Math.floor(j/2+(i-k)*a.ellipticity*Math.sin(l/b*2*Math.PI)-g/2)]);if(m.shuffle().some(function(b){if(r(b[0],b[1],f,g)){var e=h("<img />");e.css({width:(f*a.gridSize).toString(10)+"px",height:(g*a.gridSize).toString(10)+"px",left:(b[0]*a.gridSize).toString(10)+
"px",top:(b[1]*a.gridSize).toString(10)+"px",display:"none",opacity:k*k/i/i});e[0].onload=function(){h(this).fadeIn(a.fadeIn)};var j=h('<a href="'+c.link_url+'" target="_blank" />').append(e);j.attr("title",c.title);d.append(j);e[0].src=c.photo_url;s(b[0],b[1],f,g);return!0}return!1}))return!0}return!1};if({flickr:function(d){h.getJSON("http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(a.query+' and extras="url_'+a.flickrSize+'"')+"&format=json&diagnostics=true&callback=?",function(a){!a.query.results||
!a.query.results.photo?d(!1):d(a.query.results.photo)})}}[a.photoListType]&&!a.photos&&a.query){var u=this;getFlickrPhotos(function(d){a.photos=d;u.imageCloud(a)});return this}q[a.photoListType]&&h.each(a.photos,function(d,c){a.photos[d]=q[a.photoListType](c)});if(a.shuffle)a.photos=a.photos.shuffle();return this.each(function(){e=Math.floor(this.offsetWidth/a.gridSize);j=Math.floor(this.offsetHeight/a.gridSize);i=[];p=this.offsetWidth*this.offsetHeight;o=a.photos.length;for(var d=h(this),c=e,b;c--;){i[c]=
[];for(b=j;b--;)i[c][b]=!0}d.empty();clearTimeout(d.data("imageCloud-timer"));var f=0,g=setInterval(function(){f>=a.photos.length?clearTimeout(g):(t(d,a.photos[f],f),f++)},a.wait);h(this).data("wordCloud-timer",g)})}})(jQuery);

